<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å“ç¿â™¡ç‘œæ­†å©šå®´åº§ä½æŸ¥è©¢</title>
<link rel="icon" type="image/png" href="./img/favicon.png" />
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
<style>
/* ===== å…¨å±€ ===== */
html, body {
    font-family: 'Noto Sans TC', 'Microsoft JhengHei', Arial, sans-serif;
    min-height: 100vh;
    margin: 0;
    padding: 0;
    background: radial-gradient(circle at 20% 30%, #ffd6e9, transparent 60%),
                radial-gradient(circle at 80% 70%, #ffe4f2, transparent 60%),
                #ffeef8;
    color: #333;
    overflow-x: hidden;
    overflow-y: visible;
    -webkit-overflow-scrolling: touch;
    touch-action: pan-y;
    overscroll-behavior-y: contain;
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* ===== Header ===== */
#headerBar {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 18px 16px;
    background: rgba(255, 240, 245, 0.75);
    backdrop-filter: blur(8px);
    border-bottom: 1px solid #f6d6e4;
    z-index: 999;
}
#headerBar .title {
    font-size: 16px;
    font-weight: 600;
    color: #d85b88;
    letter-spacing: 1px;
}

/* ===== å°åœ“å½¢æŒ‰éˆ• ===== */
.menu-wrapper {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 9999;
}
#menuBtn {
    width: 60px;
    height: 80px; /* é«˜ä¸€é»æ”¾æ–‡å­— */
    border-radius: 50px;
    border: none;
    background: #ff9bbd;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    animation: bounce 1.2s infinite;
    transition: transform 0.2s ease, background 0.2s ease;
}
#menuBtn:hover {
    background: #ff7bab;
    transform: scale(1.1);
}
#menuBtn img {
    width: 40px;
    height: 40px;
    pointer-events: none;
}
#menuBtn .menu-label {
    margin-top: 4px;
    font-size: 14px;
    color: #fff;
    text-align: center;
    pointer-events: none;
}
@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
}

/* ===== Container å¡ç‰‡ ===== */
.container {
    position: relative;
    width: 90%;
    max-width: 420px;
    margin: 0 auto 20px;
    text-align: center;
    padding: 25px 15px;
    border-radius: 20px;
    background: rgba(255,255,255,0.45);
    backdrop-filter: blur(14px);
    box-shadow: 0 10px 25px rgba(255, 105, 180, 0.3);
    display: flex;
    flex-direction: column;
    align-items: center;
}
.container h1 {
    font-size: 28px;
    font-weight: 400;
    letter-spacing: 0.5px;
}
/* å¿ƒå½¢è£é£¾ */
.container::after {
    content: 'ğŸ€';
    position: absolute;
    top: 12px;
    right: 12px;
    font-size: 24px;
    color: rgba(255,105,180,0.6);
    animation: heartbeat 1.5s infinite;
    pointer-events: none;
}
@keyframes heartbeat {
    0%, 100% { transform: scale(1); }
    25%, 75% { transform: scale(1.2); }
    50% { transform: scale(1.1); }
}

/* ===== æ¨™é¡Œ ===== */
h1 {
    color: #ff5fa2;
    font-size: 22px;
    margin: 8px 0;
    text-shadow: 0 2px 6px rgba(255, 150, 200, 0.4);
}

/* ===== è¼¸å…¥æ¡† ===== */
input[type="text"] {
    width: 80%;
    max-width: 350px;
    padding: 12px 15px;
    border-radius: 12px;
    border: 2px solid #ffceeb;
    background: #fff8fc;
    font-size: 16px;
    margin: 10px 0;
    box-shadow: inset 0 0 8px rgba(255, 150, 200, 0.2);
    transition: all 0.2s ease;
}
input[type="text"]:focus {
    border-color: #ff69b4;
    box-shadow: 0 0 12px rgba(255, 105, 180, 0.4);
    outline: none;
}

/* ===== æŒ‰éˆ• ===== */
button {
    width: 100%;
    max-width: 350px;
    margin: 10px 0;
    display: block;
    background: linear-gradient(135deg, #ff9acb, #ff77a9);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 12px;
    font-size: 16px;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(255, 120, 180, 0.4);
    transition: transform 0.15s ease, box-shadow 0.2s ease;
}
button:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 18px rgba(255, 120, 180, 0.55);
}

/* option æŒ‰éˆ• */
.option-btn {
    display: block;
    margin: 6px auto;
    background: linear-gradient(135deg, #ffb3cc, #ff8cb4);
    border: none;
    color: white;
    padding: 10px 15px;
    border-radius: 12px;
    width: 80%;
    cursor: pointer;
    box-shadow: 0 3px 10px rgba(255, 100, 180, 0.35);
    transition: transform 0.15s ease, box-shadow 0.2s ease;
}
.option-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(255, 100, 180, 0.45);
}

/* ===== åº§ä½åœ– ===== */
#imageWrapper {
    width: 100%;
    max-width: 400px;
    margin: 15px auto 0;
    border-radius: 16px;
    overflow: hidden;
    touch-action: pan-x pan-y;
    box-shadow: 0 6px 18px rgba(255, 120, 180, 0.35);
}
#seatMap {
    width: 100%;
    height: auto;
    border-radius: 12px;
    transform-origin: center center;
    transition: opacity 0.6s, transform 0.3s;
    opacity: 1;
}

/* ===== çµæœå€ ===== */
.result {
    font-size: 18px;
    margin-top: 15px;
    color: #ff4fa0;
    text-shadow: 0 2px 6px rgba(255, 150, 200, 0.6);
}

/* ===== Footer ===== */
footer {
    width: 100%;
    max-width: 420px;
    margin: 30px auto 40px;
    text-align: center;
    font-size: 14px;
    border-radius: 20px;
    padding: 15px 10px;  
    background: rgba(255, 240, 245, 0.75); 
    backdrop-filter: blur(12px);         
    box-shadow: 0 8px 20px rgba(255, 105, 180, 0.25);
}
.footer-text {
    font-size: 14px;
    color: #d85b88;
    letter-spacing: 0.5px;
    background: linear-gradient(120deg, #ff9acb, #ff77a9);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 2px 4px rgba(255, 105, 180, 0.3);
}

/* ===== Menu Popup ===== */
#menuPopup {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.45);
    backdrop-filter: blur(3px);
    justify-content: center;
    align-items: center;
    flex-direction: column;
    z-index: 2000;
}
#menuPopup img {
    width: 80%;
    max-width: 400px;
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.25);
}
#closePopup {
    margin-top: 10px;
    padding: 8px 14px;
    border: none;
    background: #ff77b7;
    color: white;
    border-radius: 8px;
    cursor: pointer;
}

/* ===== å‹•ç•« ===== */
.fade-in { opacity: 0; animation: fadeIn 0.8s ease-out forwards; }
@keyframes fadeIn { from { opacity: 0; transform: scale(0.98);} to {opacity:1; transform: scale(1);} }
.loading {
    width: 40px;
    height: 40px;
    border: 4px solid #ffb6c1;
    border-top-color: #ff69b4;
    border-radius: 50%;
    margin: 15px auto;
    animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* ===== æ‰‹æ©Ÿç‰ˆ ===== */
@media (max-width: 600px) {
    #headerBar .title { font-size: 16px; padding: 0 40px; display: inline-block; }
    #menuBtn { width: 50px; height: 70px; }
    #menuBtn img { width: 30px; height: 30px; }
    #menuBtn .menu-label { font-size: 12px; }
    .container h1 { font-size: 22px; }
}
</style>
</head>

<body>
  <!-- ===== Header ===== -->
  <div id="headerBar">
      <span class="title">2025.11.22 å“ç¿â™¡ç‘œæ­† å©šå®´è³‡è¨Š</span>
  </div>
  
  <!-- ===== èœå–® Popup ===== -->
  <div id="menuPopup">
      <img src="./img/menu.png" alt="Menu">
      <button id="closePopup">é—œé–‰</button>
  </div>

  <div class="container">
    <h1>å“ç¿â™¡ç‘œæ­†å©šå®´åº§ä½æŸ¥è©¢</h1>
    <input type="text" id="nameInput" placeholder="è«‹è¼¸å…¥åå­—">
    <button id="searchBtn">æŸ¥è©¢åº§ä½</button>
  
    <div class="result" id="result"></div>
  
    <!-- åº§ä½åœ– -->
    <div id="imageWrapper">
      <img id="seatMap" class="fade-in" 
           src="https://sinwoosin31.github.io/1122seatlookup/img/seat.png">
    </div>
  </div>

  <div class="menu-wrapper">
    <button id="menuBtn">
      <img src="./img/menu-icon.png" alt="é¸å–®">
      <span class="menu-label">èœå–®</span>
    </button>
  </div>

  <!-- ===== Footer ===== -->
  <footer id="footerBar">
      <div class="footer-text">Â© 2025 å“ç¿ â™¡ ç‘œæ­† å©šå®´</div>
  </footer>

<script>
const webAppUrl = "https://script.google.com/macros/s/AKfycbwt4lerkFrFEasl0XjpaiVo9OyKiKcGWMSB-VWiaBjHLhP67M6l3q6teo4YB8vOWPp1/exec";
const nameInput = document.getElementById("nameInput");
const resultDiv = document.getElementById("result");
const wrapper = document.getElementById("imageWrapper");
const img = document.getElementById("seatMap");

const cache = {};
const maskCache = {};
let debounceTimer;

// ===== å§“åéš±ç¢¼ =====
function maskNameCached(name) {
    if (maskCache[name]) return maskCache[name];
    const len = name.length;
    let masked;
    if (name.includes("é˜¿")) masked = name;
    else if (len <= 1) masked = name;
    else if (len === 2) masked = name[0] + "*";
    else if (len === 3) masked = name[0] + "*" + name[len - 1];
    else masked = name;
    maskCache[name] = masked;
    return masked;
}

// ===== æ¸²æŸ“çµæœ =====
function renderResult(data) {
    resultDiv.innerHTML = "";
    if (data.seat) {
        resultDiv.innerHTML = `ğŸ€ ${data.name} çš„åº§ä½æ˜¯ ${data.seat} ğŸ€<br>`;
    } else if (data.multiple) {
        resultDiv.textContent = "æ‰¾åˆ°å¤šä½ç¬¦åˆçš„è³“å®¢ï¼Œè«‹é¸æ“‡ï¼š";
        data.multiple.forEach(item => {
            const btn = document.createElement("button");
            btn.className = "option-btn";
            btn.textContent = maskNameCached(item.name);
            btn.onclick = () => {
                resultDiv.innerHTML = `ğŸ€ ${item.name} çš„åº§ä½æ˜¯ ${item.seat} ğŸ€<br>`;
            };
            resultDiv.appendChild(btn);
        });
    } else {
        resultDiv.textContent = data.error || "æŸ¥ç„¡è³‡æ–™";
    }
}

// ===== æŸ¥è©¢ =====
function searchSeat() {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => {
        const name = nameInput.value.trim();
        if (!name) return resultDiv.textContent = "è«‹è¼¸å…¥åå­—";

        if (name.toLowerCase() === "æ¸…å¿«å–") {
            fetch(`${webAppUrl}?name=æ¸…å¿«å–`)
                .then(res => res.json())
                .then(data => {
                    resultDiv.textContent = data.success || "å¿«å–å·²æ¸…é™¤";
                    Object.keys(cache).forEach(k => delete cache[k]);
                })
                .catch(() => resultDiv.textContent = "æ¸…å¿«å–å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦");
            return;
        }

        if (cache[name]) {
            renderResult(cache[name]);
            return;
        }

        resultDiv.textContent = "æŸ¥è©¢ä¸­...";
        fetch(`${webAppUrl}?name=${encodeURIComponent(name)}`)
            .then(res => res.json())
            .then(data => {
                cache[name] = data;
                renderResult(data);
            })
            .catch(() => resultDiv.textContent = "æŸ¥è©¢å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦");

    }, 250);
}

document.getElementById("searchBtn").addEventListener("click", searchSeat);
nameInput.addEventListener("keypress", e => { if(e.key === "Enter") searchSeat(); });

// ===== iOS æ‹–æ›³ç¸®æ”¾ =====
let scale = 1, lastScale = 1, posX = 0, posY = 0, lastX = 0, lastY = 0, startDistance = 0, ticking = false;

wrapper.addEventListener("touchstart", (e) => {
    if (e.touches.length === 2) startDistance = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY);
    else if (e.touches.length === 1) { lastX = e.touches[0].clientX - posX; lastY = e.touches[0].clientY - posY; }
}, { passive: false });

wrapper.addEventListener("touchmove", (e) => {
    if (scale <= 1) return;
    e.preventDefault();
    if (e.touches.length === 2) {
        const newDist = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY);
        scale = Math.min(Math.max(lastScale * (newDist / startDistance), 1), 3);
        requestUpdate();
    } else if (e.touches.length === 1) {
        posX = e.touches[0].clientX - lastX;
        posY = e.touches[0].clientY - lastY;
        requestUpdate();
    }
}, { passive: false });

wrapper.addEventListener("touchend", () => { lastScale = scale; clampPosition(); requestUpdate(); });
function requestUpdate() { if (!ticking) { requestAnimationFrame(() => { img.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`; ticking = false; }); ticking = true; } }
function clampPosition() {
    const maxX = (img.offsetWidth * scale - wrapper.offsetWidth)/2;
    const maxY = (img.offsetHeight * scale - wrapper.offsetHeight)/2;
    posX = Math.max(Math.min(posX, maxX), -maxX);
    posY = Math.max(Math.min(posY, maxY), -maxY);
}

// ===== Menu Popup =====
const menuBtn = document.getElementById("menuBtn");
const menuPopup = document.getElementById("menuPopup");
const closePopup = document.getElementById("closePopup");

menuBtn.addEventListener("click", () => { menuPopup.style.display = "flex"; });
closePopup.addEventListener("click", () => { menuPopup.style.display = "none"; });
</script>
</body>
</html>
