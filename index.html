<!DOCTYPE html>
<html lang="zh-TW">
<head>
<link rel="icon" type="image/png" href="./img/favicon.png" />
<link rel="icon" type="image/png" sizes="32x32" href="./img/favicon.png">
<link rel="icon" type="image/png" sizes="96x96" href="./img/favicon.png">
<link rel="apple-touch-icon" href="./img/favicon.png">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å“ç¿â™¡ç‘œæ­†å©šå®´åº§ä½æŸ¥è©¢</title>

<style>
  /* ===== å…¨å±€ ===== */
  body {
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 20px 15px;
    min-height: 100vh;
    display: block;
    justify-content: center;
    align-items: flex-start;
    background: radial-gradient(circle at 20% 30%, #ffd6e9, transparent 60%),
                radial-gradient(circle at 80% 70%, #ffe4f2, transparent 60%),
                #ffeef8;
    color: #333;
    overflow-x: hidden;
  }
  
  /* ===== ç»ç’ƒå¡ç‰‡ Container ===== */
  .container {
    max-width: 500px; 
    background: rgba(255, 255, 255, 0.45);
    backdrop-filter: blur(12px);
    padding: 25px 25px;
    border-radius: 20px;
    box-shadow: 0 10px 25px rgba(255, 105, 180, 0.3);
    width: 100%;
    max-width: 420px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.6);
    animation: fadeIn 1s ease;
    margin: 20px auto 40px auto;
    display: block; 
    text-align: center;
  }
  
  /* ===== æ¨™é¡Œ ===== */
  h1 {
    color: #ff5fa2;
    font-size: 22px;
    margin: 8px 0;
    text-shadow: 0 2px 6px rgba(255, 150, 200, 0.4);
  }
  
  /* ===== è¼¸å…¥æ¡† ===== */
  input[type="text"] {
    width: 82%;
    padding: 12px 15px;
    border-radius: 12px;
    border: 2px solid #ffceeb;
    background: #fff8fc;
    font-size: 16px;
    margin-bottom: 15px;
    box-shadow: inset 0 0 8px rgba(255, 150, 200, 0.2);
    transition: all 0.2s ease;
  }
  input[type="text"]:focus {
    border-color: #ff69b4;
    box-shadow: 0 0 12px rgba(255, 105, 180, 0.4);
    outline: none;
  }
  
  /* ===== æŒ‰éˆ• ===== */
  button {
    background: linear-gradient(135deg, #ff9acb, #ff77a9);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 12px;
    font-size: 16px;
    cursor: pointer;
    width: 90%;
    margin-bottom: 10px;
    box-shadow: 0 4px 12px rgba(255, 120, 180, 0.4);
    transition: transform 0.15s ease, box-shadow 0.2s ease;
  }
  button:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 18px rgba(255, 120, 180, 0.55);
  }
  
  /* ===== å¤šé¸æŒ‰éˆ• ===== */
  .option-btn {
    display: block;
    margin: 6px auto;
    background: linear-gradient(135deg, #ffb3cc, #ff8cb4);
    border: none;
    color: white;
    padding: 10px 15px;
    border-radius: 12px;
    width: 80%;
    cursor: pointer;
    box-shadow: 0 3px 10px rgba(255, 100, 180, 0.35);
    transition: transform 0.15s ease, box-shadow 0.2s ease;
  }
  .option-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(255, 100, 180, 0.45);
  }
  
  /* ===== åº§ä½åœ–å®¹å™¨ ===== */
  #imageWrapper {
    width: 100%;
    overflow: hidden;
    border-radius: 16px;
    margin-top: 15px;
    touch-action: none;
    box-shadow: 0 6px 18px rgba(255, 120, 180, 0.35);
  }
  
  /* ===== åº§ä½åœ–æœ¬é«” ===== */
  #seatMap {
    width: 100%;
    height: auto;
    border-radius: 12px;
    transform-origin: center center;
    transition: opacity 0.6s, transform 0.3s;
    /*animation: fadeIn 1.2s ease-out;*/
    opacity: 1;
  }
  
  /* ===== çµæœå€ ===== */
  .result {
    font-size: 18px;
    margin-top: 15px;
    color: #ff4fa0;
    text-shadow: 0 2px 4px rgba(255, 150, 200, 0.4);
  }
  
  /* ===== æ·¡å…¥å‹•ç•« ===== */
  .fade-in {
    opacity: 0;
    animation: fadeIn 0.8s ease-out forwards;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: scale(0.98); }
    to   { opacity: 1; transform: scale(1); }
  }
  
  /* ===== å¯æ“´å±• Loading å‹•ç•« ===== */
  .loading {
    width: 40px;
    height: 40px;
    border: 4px solid #ffb6c1;
    border-top-color: #ff69b4;
    border-radius: 50%;
    margin: 15px auto;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  >
    /* Header */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: #f8e1f4;
    }
    header .title {
      font-weight: bold;
      font-size: 1.2rem;
    }
    header button {
      padding: 5px 10px;
      border: none;
      border-radius: 5px;
      background: #ff69b4;
      color: white;
      cursor: pointer;
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 10px 20px;
      background: #f8e1f4;
      font-size: 0.9rem;
      color: #666;
      position: relative;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 100;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.7);
    }
    .modal-content {
      display: block;
      margin: 50px auto;
      max-width: 90%;
      max-height: 80%;
      border-radius: 10px;
      touch-action: pan-x pan-y;
      transform-origin: center center;
      transition: transform 0.2s ease;
    }
    .close {
      position: absolute;
      top: 20px;
      right: 30px;
      color: #fff;
      font-size: 2rem;
      font-weight: bold;
      cursor: pointer;
    }

    @media(max-width: 600px){
      header { flex-direction: column; gap: 10px; }
    }
</style>
</head>
<body>
  <header>
    <div class="title">ğŸ’ Rui & Sheena Wedding 2025/11/22</div>
    <button id="menuBtn">ğŸ½ èœå–®</button>
  </header>
  <div class="container">
    <h1>å“ç¿â™¡ç‘œæ­†å©šå®´åº§ä½æŸ¥è©¢</h1>
    <h1>ğŸ€</h1>
  
    <input type="text" id="nameInput" placeholder="è«‹è¼¸å…¥åå­—">
    <button id="searchBtn">æŸ¥è©¢åº§ä½</button>
  
    <div class="result" id="result"></div>
  
    <!-- åº§ä½åœ–ï¼ˆé å…ˆé¡¯ç¤ºï¼‰ -->
    <div id="imageWrapper">
      <img id="seatMap" class="fade-in" src="https://sinwoosin31.github.io/1122seatlookup/img/seat.png">
    </div>
  </div>
  
  <footer>
    <p>Â© Rui & Sheena Wedding 20251122</p>
    <p>â¤ï¸â¤ï¸â¤ï¸â¤ï¸</p>
  </footer>
  
 <!-- Modal -->
  <div id="menuModal" class="modal">
    <span class="close">&times;</span>
    <img src="https://sinwoosin31.github.io/1122seatlookup/img/seat.png" alt="å©šç¦®èœå–®" class="modal-content">
  </div>

<script>
  // ========= åŸºæœ¬è¨­å®š =========
  const webAppUrl = "https://script.google.com/macros/s/AKfycbwt4lerkFrFEasl0XjpaiVo9OyKiKcGWMSB-VWiaBjHLhP67M6l3q6teo4YB8vOWPp1/exec";
  const nameInput = document.getElementById("nameInput");
  const resultDiv = document.getElementById("result");
    
  // ========= å¿«å–è¨­å®š =========
  const cache = {};
  const maskCache = {};
  let debounceTimer;
  
  // ========= é è¼‰åº§ä½åœ– =========
  const seatImg = new Image();
  seatImg.src = "https://sinwoosin31.github.io/1122seatlookup/img/seat.png";
  
  // ========= å§“åéš±ç¢¼ (å¿«å–) =========
  function maskNameCached(name) {
      if (maskCache[name]) return maskCache[name];
  
      const len = name.length;
      let masked;
      if (name.includes("é˜¿")) masked = name;
      else if (len <= 1) masked = name;
      else if (len === 2) masked = name[0] + "*";
      else if (len === 3) masked = name[0] + "*" + name[len - 1];
      //else masked = name[0] + "***" + name[len - 1];
      else if (len > 3) masked = name;
    
      maskCache[name] = masked;
      return masked;
  }

  // ========= æ¸²æŸ“çµæœ =========
  function renderResult(data) {
      resultDiv.innerHTML = "";
      if (data.seat) {
          resultDiv.innerHTML = `ğŸ€ ${data.name} çš„åº§ä½æ˜¯ ${data.seat} ğŸ€<br>`;
      } else if (data.multiple) {
          resultDiv.textContent = "æ‰¾åˆ°å¤šä½ç¬¦åˆçš„è³“å®¢ï¼Œè«‹é¸æ“‡ï¼š";
          data.multiple.forEach(item => {
              const btn = document.createElement("button");
              btn.className = "option-btn";
              btn.textContent = maskNameCached(item.name);
              btn.onclick = () => {
                  resultDiv.innerHTML = `ğŸ€ ${item.name} çš„åº§ä½æ˜¯ ${item.seat} ğŸ€<br>`;
              };
              resultDiv.appendChild(btn);
          });
      } else {
          resultDiv.textContent = data.error || "æŸ¥ç„¡è³‡æ–™";
      }
  }

  // ========= æŸ¥è©¢åº§ä½ï¼ˆå¿«å– + é˜²æŠ–ï¼‰ =========
  function searchSeat() {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(() => {
          const name = nameInput.value.trim();
          if (!name) return resultDiv.textContent = "è«‹è¼¸å…¥åå­—";

          // ==== æ¸…å¿«å–åˆ¤æ–· ====
          if (name.toUpperCase() === "æ¸…å¿«å–") {
              fetch(`${webAppUrl}?name=æ¸…å¿«å–`)
                  .then(res => res.json())
                  .then(data => {
                      resultDiv.textContent = data.success || "å¿«å–å·²æ¸…é™¤";
                      Object.keys(cache).forEach(k => delete cache[k]); // æ¸…å‰ç«¯å¿«å–
                  })
                  .catch(() => {
                      resultDiv.textContent = "æ¸…å¿«å–å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦";
                  });
              return; // çµæŸå‡½å¼ï¼Œä¸åšå…¶ä»–æŸ¥è©¢
          }
  
          if (cache[name]) {
              renderResult(cache[name]);
              return;
          }
  
          resultDiv.textContent = "æŸ¥è©¢ä¸­...";
          fetch(`${webAppUrl}?name=${encodeURIComponent(name)}`)
              .then(res => res.json())
              .then(data => {
                  cache[name] = data;
                  renderResult(data);
              })
              .catch(() => {
                  resultDiv.textContent = "æŸ¥è©¢å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦";
              });
      }, 250); // 250ms é˜²æŠ–
  }

  // ========= äº‹ä»¶ç¶å®š =========
  document.getElementById("searchBtn").addEventListener("click", searchSeat);
  nameInput.addEventListener("keypress", e => { if(e.key === "Enter") searchSeat(); });

  // ========= åº§ä½åœ–ç¸®æ”¾èˆ‡æ‹–æ›³ =========
  const img = document.getElementById("seatMap");
  let scale = 1, lastScale = 1;
  let posX = 0, posY = 0;
  let lastX = 0, lastY = 0;
  let startDistance = 0;
  let ticking = false;

  img.style.willChange = "transform";

  img.addEventListener("touchstart", (e) => {
      if (e.touches.length === 2) {
          startDistance = getDistance(e.touches[0], e.touches[1]);
      } else if (e.touches.length === 1) {
          lastX = e.touches[0].clientX - posX;
          lastY = e.touches[0].clientY - posY;
      }
  }, { passive: false });
  
  img.addEventListener("touchmove", (e) => {
      e.preventDefault();
  
      if (e.touches.length === 2) {
          const newDist = getDistance(e.touches[0], e.touches[1]);
          scale = Math.min(Math.max(lastScale * (newDist / startDistance), 1), 3);
          requestUpdate();
      }
  
      if (e.touches.length === 1 && scale > 1) {
          posX = e.touches[0].clientX - lastX;
          posY = e.touches[0].clientY - lastY;
          requestUpdate();
      }
  }, { passive: false });
  
  img.addEventListener("touchend", () => {
      lastScale = scale;
  });
  
  function getDistance(a, b) {
      return Math.hypot(a.clientX - b.clientX, a.clientY - b.clientY);
  }
  
  function requestUpdate() {
      if (!ticking) {
          requestAnimationFrame(() => {
              img.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`;
              ticking = false;
          });
          ticking = true;
      }
  }

  // Modal é–‹é—œ
    const modal = document.getElementById("menuModal");
    const btn = document.getElementById("menuBtn");
    const span = document.querySelector(".close");
    const menuImg = document.getElementById("menuImage");

    btn.onclick = () => { 
      modal.style.display = "block"; 
      scale = 1;
      menuImg.style.transform = `scale(${scale})`;
    }
    span.onclick = () => { modal.style.display = "none"; }
    window.onclick = (event) => { if(event.target == modal){ modal.style.display = "none"; } }

    // ç°¡å–®æ‰‹å‹¢ç¸®æ”¾ (é›™æŒ‡ç¸®æ”¾)
    let scale = 1;
    let startDistance = 0;

    menuImg.addEventListener("touchstart", function(e){
      if(e.touches.length === 2){
        e.preventDefault();
        startDistance = Math.hypot(
          e.touches[0].pageX - e.touches[1].pageX,
          e.touches[0].pageY - e.touches[1].pageY
        );
      }
    }, { passive: false });

    menuImg.addEventListener("touchmove", function(e){
      if(e.touches.length === 2){
        e.preventDefault();
        const newDistance = Math.hypot(
          e.touches[0].pageX - e.touches[1].pageX,
          e.touches[0].pageY - e.touches[1].pageY
        );
        const newScale = scale * (newDistance / startDistance);
        menuImg.style.transform = `scale(${newScale})`;
      }
    }, { passive: false });

    menuImg.addEventListener("touchend", function(e){
      if(e.touches.length < 2){
        // ç´€éŒ„æœ€å¾Œ scale
        const transform = menuImg.style.transform;
        const match = transform.match(/scale\(([\d\.]+)\)/);
        if(match) scale = parseFloat(match[1]);
      }
    });
</script>
</body>
</html>
