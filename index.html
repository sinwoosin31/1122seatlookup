<!DOCTYPE html>
<html lang="zh-TW">
<head>
<link rel="icon" type="image/png" href="./img/favicon.png" />
<link rel="icon" type="image/png" sizes="32x32" href="./img/favicon.png">
<link rel="icon" type="image/png" sizes="96x96" href="./img/favicon.png">
<link rel="apple-touch-icon" href="./img/favicon.png">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å“ç¿â™¡ç‘œæ­†å©šå®´åº§ä½æŸ¥è©¢</title>
<style>
/* ===== å…¨å±€ ===== */
html, body {
    min-height: 100vh;
    margin: 0;
    padding: 0;
    font-family: 'Arial', sans-serif;
    background: radial-gradient(circle at 20% 30%, #ffd6e9, transparent 60%),
                radial-gradient(circle at 80% 70%, #ffe4f2, transparent 60%),
                #ffeef8;
    color: #333;
    overflow-x: hidden;
    overflow-y: visible;
    -webkit-overflow-scrolling: touch; 
    touch-action: pan-y;     /* æ‰‹æ©Ÿå…è¨±ä¸Šä¸‹æ»‘å‹• */
    overscroll-behavior-y: contain; /* é˜²æ­¢æ»‘å‹•è¢« JS é˜»æ“‹ */
}

body {
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    /*padding-top: 70px;  ç¢ºä¿ header ä¸æœƒè“‹ä½å…§å®¹ */
}
body.menu-open {
    position: fixed;
}
/* ===== Header ===== */
#headerBar {
    position: relative;
    display: flex;
    align-items: center;
    padding: 18px 16px;
    background: rgba(255, 240, 245, 0.75);
    backdrop-filter: blur(8px);
    border-bottom: 1px solid #f6d6e4;
    z-index: 999;
    justify-content: center; 
}

#headerBar .title {
    font-size: 16px;
    font-family: 'Noto Sans TC', 'Microsoft JhengHei', sans-serif;
    font-weight: 600;
    color: #d85b88;
    letter-spacing: 1px;
}

/* ===== å°åœ“å½¢æŒ‰éˆ• ===== */
.menu-wrapper {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 9999;
}
.menu-btn-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    animation: bounce 1.2s infinite;
}
.menu-wrapper #menuBtn {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    border: none;
    box-shadow:
        inset -2px -2px 8px rgba(255,255,255,0.3),
        inset 2px 2px 6px rgba(255,105,180,0.2),
        0 4px 12px rgba(255,105,180,0.5);
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(3px);
    -webkit-backdrop-filter: blur(3px);
    color: white;
    cursor: pointer;
    display: flex;           
    justify-content: center; 
    align-items: center;    
    padding: 0;              
    line-height: 1;      
    animation: bounce 2s infinite;
}

.menu-wrapper .menu-label {
    margin-top: 6px;
    font-size: 14px;
    color: #d85b88;
    font-family: 'Noto Sans TC', 'Microsoft JhengHei', sans-serif;
    text-align: center;
}

.menu-label {
    margin-top: 6px;
    font-size: 14px;
    color: #d85b88;
    font-family: 'Noto Sans TC', 'Microsoft JhengHei', sans-serif;
    text-align: center;
    pointer-events: none;
}
    
#menuBtn {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    transition: transform 0.15s ease, background 0.2s ease, box-shadow 0.2s ease;
    outline: none;
    -webkit-tap-highlight-color: transparent;
}
#menuBtn:active {
    transform: scale(0.95); 
    background: radial-gradient(circle at 30% 30%, #ffd0e0 0%, #ff88b0 50%, #ff6699 100%);
    box-shadow:
        inset -2px -2px 6px rgba(255,255,255,0.4),
        inset 2px 2px 6px rgba(255,105,180,0.2),
        0 4px 12px rgba(255,105,180,0.35),
        0 0 15px rgba(255,182,193,0.15);
}
#menuBtn:hover {
    transform: scale(1.05);
    background: radial-gradient(circle at 30% 30%, #fff5fa 0%, #ffe0eb 50%, #ff88b0 100%);
    box-shadow:
        inset -3px -3px 10px rgba(255,255,255,0.7),
        inset 3px 3px 8px rgba(255,105,180,0.35),
        0 8px 18px rgba(255,105,180,0.45),
        0 0 25px rgba(255,182,193,0.25);
}
#menuBtn img {
    width: 50px;
    height: 50px;
    pointer-events: none;
}
#menuBtn .menu-label {
    font-size: 12px;
    color: #d85b88;
    font-family: 'Noto Sans TC', 'Microsoft JhengHei', sans-serif;
    pointer-events: none; 
    margin-top: -5px;
    text-shadow: 0 1px 2px rgba(255,255,255,0.7);
}
/* å°è·³å‹•å‹•ç•« */
@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    25%, 75% { transform: translateY(-6px); } 
    50% { transform: translateY(-12px); }    
}
    
.menu-btn-wrapper .menu-label {
    font-size: 14px;
}
    
/* ===== Container å¡ç‰‡ ===== */
.container {
    position: relative; 
    width: 90%;
    max-width: 420px;
    margin: 0 auto 20px;
    text-align: center;
    padding: 25px 15px;
    border-radius: 20px;
    background: rgba(255,255,255,0.45);
    backdrop-filter: blur(14px);
    box-shadow: 0 10px 25px rgba(255, 105, 180, 0.3);
    display: flex;
    flex-direction: column;
    align-items: center;
}
.container h1 {
    font-family: 'Noto Sans TC', 'Microsoft JhengHei', sans-serif;
    font-size: 28px;
    font-weight: 400;
    letter-spacing: 0.5px;
}
/* å¿ƒå½¢è£é£¾ */
.container::after {
    content: 'ğŸ€';
    position: absolute;
    top: 12px;
    right: 12px;
    font-size: 24px;
    color: rgba(255,105,180,0.6);
    animation: heartbeat 1.5s infinite;
    transform: translate(0, 0);
    pointer-events: none;  
}
@keyframes heartbeat {
    0%, 100% { transform: translate(-50%, -50%) scale(1); }
    25%, 75% { transform: translate(-50%, -50%) scale(1.2); }
    50% { transform: translate(-50%, -50%) scale(1.1); }
}

/* ===== æ¨™é¡Œ ===== */
h1 {
    color: #ff5fa2;
    font-size: 22px;
    margin: 8px 0;
    text-shadow: 0 2px 6px rgba(255, 150, 200, 0.4);
}

/* ===== è¼¸å…¥æ¡† ===== */
input[type="text"] {
    width: 80%;
    max-width: 350px;
    padding: 12px 15px;
    border-radius: 12px;
    border: 2px solid #ffceeb;
    background: #fff8fc;
    font-size: 16px;
    margin: 10px 0;
    box-shadow: inset 0 0 8px rgba(255, 150, 200, 0.2);
    transition: all 0.2s ease;
}
input[type="text"]:focus {
    border-color: #ff69b4;
    box-shadow: 0 0 12px rgba(255, 105, 180, 0.4);
    outline: none;
}

/* ===== æŒ‰éˆ• ===== */
button {
    width: 100%;
    max-width: 350px;
    margin: 10px 0;
    display: block;
    background: linear-gradient(135deg, #ff9acb, #ff77a9);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 12px;
    font-size: 16px;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(255, 120, 180, 0.4);
    transition: transform 0.15s ease, box-shadow 0.2s ease;
}
button:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 18px rgba(255, 120, 180, 0.55);
}

/* option æŒ‰éˆ• */
.option-btn {
    display: block;
    margin: 6px auto;
    background: linear-gradient(135deg, #ffb3cc, #ff8cb4);
    border: none;
    color: white;
    padding: 10px 15px;
    border-radius: 12px;
    width: 80%;
    cursor: pointer;
    box-shadow: 0 3px 10px rgba(255, 100, 180, 0.35);
    transition: transform 0.15s ease, box-shadow 0.2s ease;
}
.option-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(255, 100, 180, 0.45);
}

/* ===== åº§ä½åœ– ===== */
#imageWrapper {
    position: relative;
    width: 100%;
    max-width: 400px;
    margin: 15px auto 0;
    border-radius: 16px;
    overflow: hidden;
    touch-action: pan-x pan-y;
    box-shadow: 0 6px 18px rgba(255, 120, 180, 0.35);
}
#seatMap {
    width: 100%;
    height: auto;
    border-radius: 12px;
    transform-origin: center center;
    transition: opacity 0.6s, transform 0.3s;
    opacity: 1;
}

/* ===== çµæœå€ ===== */
.result {
    font-size: 18px;
    margin-top: 15px;
    color: #ff4fa0;
    text-shadow: 0 2px 6px rgba(255, 150, 200, 0.6);
}

/* ===== Footer ===== */
footer {
    width: 100%;
    max-width: 420px;
    margin: 30px auto 40px;
    text-align: center;
    font-size: 14px;
    border-radius: 20px;
    padding: 15px 10px;  
    background: rgba(255, 240, 245, 0.75); 
    backdrop-filter: blur(12px);         
    box-shadow: 0 8px 20px rgba(255, 105, 180, 0.25);
}
.footer-text {
    font-size: 14px;
    font-family: 'Noto Sans TC', 'Microsoft JhengHei', sans-serif;
    color: #d85b88;
    letter-spacing: 0.5px;
    background: linear-gradient(120deg, #ff9acb, #ff77a9); /* æ¼¸å±¤æ–‡å­— */
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 2px 4px rgba(255, 105, 180, 0.3); /* æŸ”å’Œé™°å½±å¢åŠ å°æ¯” */
}

/* ===== Menu Popup ===== */
#menuPopup {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.45);
    backdrop-filter: blur(3px);
    justify-content: center;
    align-items: center;
    flex-direction: column;
    z-index: 2000;
}
#menuPopup img {
    width: 80%;
    max-width: 400px;
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.25);
}
#closePopup {
    margin-top: 10px;
    padding: 8px 14px;
    border: none;
    background: #ff77b7;
    color: white;
    border-radius: 8px;
    cursor: pointer;
}

/* ===== å‹•ç•« ===== */
.fade-in { opacity: 0; animation: fadeIn 0.8s ease-out forwards; }
@keyframes fadeIn { from { opacity: 0; transform: scale(0.98);} to {opacity:1; transform: scale(1);} }

.loading {
    width: 40px;
    height: 40px;
    border: 4px solid #ffb6c1;
    border-top-color: #ff69b4;
    border-radius: 50%;
    margin: 15px auto;
    animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* ===== æ‰‹æ©Ÿç‰ˆ ===== */
@media (max-width: 600px) {
    #headerBar .title { font-size: 16px; padding: 0 40px; display: inline-block; }
    #menuBtn { width: 60px; height: 60px; }
    #menuBtn img { width: 50px; height: 50px; }
    .menu-label { font-size: 12px; }
    .container h1 {
        font-size: 22px; 
    }
}
#heartMarker {
    position: absolute;
    top: 0;
    left: 0;
    font-size: 32px;
    transform: translate(-50%, -50%);
    display: none; /* é è¨­éš±è— */
    z-index: 2000;
    animation: floatGlow 2s ease-in-out infinite;
}
@keyframes floatGlow {
    0%   { transform: translate(-50%, -50%) translateY(0); text-shadow: 0 0 5px #ff77b7; }
    50%  { transform: translate(-50%, -50%) translateY(-8px); text-shadow: 0 0 15px #ff77b7; }
    100% { transform: translate(-50%, -50%) translateY(0); text-shadow: 0 0 5px #ff77b7; }
}
</style>
</head>

<body>
  <!-- ===== Header ===== -->
  <div id="headerBar">
      <span class="title">2025.11.22 å“ç¿â™¡ç‘œæ­† å©šå®´è³‡è¨Š</span>
ã€€</div>
  
  <!-- ===== èœå–® Popup ===== -->
  ã€€<div id="menuPopup">
      <img src="./img/menu.png" alt="Menu">
    </div>

  <div class="container">
    <h1>å“ç¿â™¡ç‘œæ­†å©šå®´åº§ä½æŸ¥è©¢</h1>
    <input type="text" id="nameInput" placeholder="è«‹è¼¸å…¥åå­—">
    <button id="searchBtn">æŸ¥è©¢åº§ä½</button>
  
    <div class="result" id="result"></div>
  
    <!-- åº§ä½åœ–ï¼ˆé å…ˆé¡¯ç¤ºï¼‰ -->
    <div id="imageWrapper">
        <img id="seatMap" class="fade-in" 
           src="https://sinwoosin31.github.io/1122seatlookup/img/seat.png">
        <div id="heartMarker">â¤ï¸</div>
    </div>
    
  </div>
<div class="menu-wrapper">
  <div class="menu-btn-wrapper">
    <button id="menuBtn">
      <img src="./img/menu-icon.png" alt="é¸å–®">
      <span class="menu-label">èœå–®</span>
    </button>
  </div>
</div>
    <!-- ===== Footer ===== -->
    <footer id="footerBar">
      <div class="footer-text">Â© 2025 å“ç¿ â™¡ ç‘œæ­† å©šå®´</div>
    </footer>
<script>
  // ========= åŸºæœ¬è¨­å®š =========
  const webAppUrl = "https://script.google.com/macros/s/AKfycbwt4lerkFrFEasl0XjpaiVo9OyKiKcGWMSB-VWiaBjHLhP67M6l3q6teo4YB8vOWPp1/exec";
  const nameInput = document.getElementById("nameInput");
  const resultDiv = document.getElementById("result");
  const wrapper = document.getElementById("imageWrapper");
  const img = document.getElementById("seatMap");

  // ========= å¿«å– =========
  const cache = {};
  const maskCache = {};
  let debounceTimer;

  // ========= å§“åéš±ç¢¼ =========
  function maskNameCached(name) {
      if (maskCache[name]) return maskCache[name];

      const len = name.length;
      let masked;
      if (name.includes("é˜¿")) masked = name;
      else if (len <= 1) masked = name;
      else if (len === 2) masked = name[0] + "*";
      else if (len === 3) masked = name[0] + "*" + name[len - 1];
      else masked = name;

      maskCache[name] = masked;
      return masked;
  }

  // ========= æ¸²æŸ“çµæœ =========
  function renderResult(data) {
      resultDiv.innerHTML = "";
      if (data.seat) {
          resultDiv.innerHTML = `ğŸ€ ${data.name} çš„åº§ä½æ˜¯ ${data.seat} ğŸ€<br>`;
          if(tablePositions[data.seat]) {
            showHeart(data.seat);
          }else {
                hideHeart();
            }
      } else if (data.multiple) {
          resultDiv.textContent = "æ‰¾åˆ°å¤šä½ç¬¦åˆçš„è³“å®¢ï¼Œè«‹é¸æ“‡ï¼š";
          data.multiple.forEach(item => {
              const btn = document.createElement("button");
              btn.className = "option-btn";
              btn.textContent = maskNameCached(item.name);
              btn.onclick = () => {
                  resultDiv.innerHTML = `ğŸ€ ${item.name} çš„åº§ä½æ˜¯ ${item.seat} ğŸ€<br>`;
              };
              if(tablePositions[data.seat]) {
                showHeart(data.seat);
              }else {
                    hideHeart();
                }
              resultDiv.appendChild(btn);
          });
      } else {
          resultDiv.textContent = data.error || "æŸ¥ç„¡è³‡æ–™";
      }
  }

  // ========= æŸ¥è©¢ =========
  function searchSeat() {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(() => {
          const name = nameInput.value.trim();
          if (!name) return resultDiv.textContent = "è«‹è¼¸å…¥åå­—";

          // ==== æ¸…å¿«å– ====
          if (name.toUpperCase() === "æ¸…å¿«å–") {
              fetch(`${webAppUrl}?name=æ¸…å¿«å–`)
                  .then(res => res.json())
                  .then(data => {
                      resultDiv.textContent = data.success || "å¿«å–å·²æ¸…é™¤";
                      Object.keys(cache).forEach(k => delete cache[k]);
                  })
                  .catch(() => {
                      resultDiv.textContent = "æ¸…å¿«å–å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦";
                  });
              return;
          }

          if (cache[name]) {
              renderResult(cache[name]);
              return;
          }

          resultDiv.textContent = "æŸ¥è©¢ä¸­...";
          fetch(`${webAppUrl}?name=${encodeURIComponent(name)}`)
              .then(res => res.json())
              .then(data => {
                  cache[name] = data;
                  renderResult(data);
              })
              .catch(() => {
                  resultDiv.textContent = "æŸ¥è©¢å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦";
              });

      }, 250);
  }

  document.getElementById("searchBtn").addEventListener("click", searchSeat);
  nameInput.addEventListener("keypress", e => { if(e.key === "Enter") searchSeat(); });

  // ========= iOS ä¿®æ­£ç‰ˆæ‹–æ›³ç¸®æ”¾ =========

  let scale = 1, lastScale = 1;
  let posX = 0, posY = 0;
  let lastX = 0, lastY = 0;
  let startDistance = 0;
  let ticking = false;

  wrapper.addEventListener("touchstart", (e) => {
      if (e.touches.length === 2) {
          startDistance = getDistance(e.touches[0], e.touches[1]);
      } else if (e.touches.length === 1) {
          lastX = e.touches[0].clientX - posX;
          lastY = e.touches[0].clientY - posY;
      }
  }, { passive: false });

  wrapper.addEventListener("touchmove", (e) => {
    if (scale <= 1) return;  // æœªæ”¾å¤§æ™‚ä¸åšä»»ä½• transformï¼Œä¹Ÿä¸é˜»æ­¢é é¢æ»¾å‹•

    e.preventDefault();       // åªæœ‰æ”¾å¤§æ™‚é˜»æ­¢é è¨­æ»¾å‹•

    if (e.touches.length === 2) {
        const newDist = getDistance(e.touches[0], e.touches[1]);
        scale = Math.min(Math.max(lastScale * (newDist / startDistance), 1), 3);
        requestUpdate();
    } else if (e.touches.length === 1) {
        posX = e.touches[0].clientX - lastX;
        posY = e.touches[0].clientY - lastY;
        requestUpdate();
    }
}, { passive: false });



  wrapper.addEventListener("touchend", () => {
      lastScale = scale;

      // é˜²æ­¢æ‹–å‡ºç•«é¢é€ æˆç™½å€å¡Š
      clampPosition();
      requestUpdate();
  });

  function getDistance(a, b) {
      return Math.hypot(a.clientX - b.clientX, a.clientY - b.clientY);
  }

  function clampPosition() {
      const maxX = (img.clientWidth * scale - wrapper.clientWidth) / 2;
      const maxY = (img.clientHeight * scale - wrapper.clientHeight) / 2;

      posX = Math.min(Math.max(posX, -maxX), maxX);
      posY = Math.min(Math.max(posY, -maxY), maxY);
  }

  function requestUpdate() {
      if (!ticking) {
        requestAnimationFrame(() => {
            img.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`;
            updateHeart();
            ticking = false;
        });
        ticking = true;
    }
  }
  
    // ===== Popup é–‹é—œæ§åˆ¶ =====
    const menuBtn = document.getElementById("menuBtn");
    const menuPopup = document.getElementById("menuPopup");
    
    // å»ºç«‹ä¸€å€‹ close æŒ‰éˆ•
    const closePopup = document.createElement("button");
    closePopup.id = "closePopup";
    closePopup.textContent = "é—œé–‰";
    closePopup.style.marginTop = "10px";
    closePopup.style.padding = "8px 14px";
    closePopup.style.border = "none";
    closePopup.style.background = "#ff77b7";
    closePopup.style.color = "white";
    closePopup.style.borderRadius = "8px";
    closePopup.style.cursor = "pointer";
    menuPopup.appendChild(closePopup);
    
    // é»æŒ‰éˆ•é–‹å•Ÿ
    menuBtn.addEventListener("click", () => {
        menuPopup.style.display = "flex";
        document.body.classList.add("menu-open");
    });
    
    // é»é—œé–‰æŒ‰éˆ•é—œé–‰
    closePopup.addEventListener("click", () => {
        menuPopup.style.display = "none";
        document.body.classList.remove("menu-open");
    });
    
    // é»èƒŒæ™¯é—œé–‰
    menuPopup.addEventListener("click", (e) => {
        if (e.target === menuPopup) {
            menuPopup.style.display = "none";
            document.body.classList.remove("menu-open");
        }
    });

    const heart = document.getElementById("heartMarker");
    const tablePositions = {
        "ç•¶ç„¶æ˜¯ä¸»æ¡Œå•Š!!": { x: 509.4, y: 343 },
        "ä¸»æ¡Œ": { x: 509.4, y: 343 },
        "1": { x: 803, y: 551 },
        "2": { x: 803, y: 714.4 },
        "3": { x: 803, y: 875.5 },
        "4": { x: 803, y: 1040.5 },
        "6": { x: 634.9, y: 551 },
        "7": { x: 634.9, y: 714.4 },
        "8": { x: 634.9, y: 875.5 },
        "9": { x: 634.9, y: 1040.5 },
        "10": { x: 634.9, y: 1205.8 },
        "11": { x: 387, y: 551 },
        "12": { x: 387, y: 714.4 },
        "13": { x: 387, y: 875.5 },
        "14": { x: 387, y: 1040.5 },
        "AKA 14": { x: 387, y: 1040.5 },
        "15": { x: 387, y: 1205.8 },
        "16": { x: 216, y: 551 },
        "17": { x: 216, y: 714.4 },
        "18": { x: 216, y: 875.5 },
        "19": { x: 216, y: 1040.5 }
    };
        
    // ========= marker =========
    function getHeartPosition(seat) {
        const pos = tablePositions[seat];
        if(!pos) return {x:0, y:0};
    
        const percentX = pos.x / img.naturalWidth;
        const percentY = pos.y / img.naturalHeight;
    
        const imgWidth  = img.clientWidth;
        const imgHeight = img.clientHeight;
    
        // åœ–ç‰‡å·¦ä¸Šè§’ç›¸å° wrapper çš„ä½ç½®
        const imgLeft = (wrapper.clientWidth - imgWidth * scale) / 2 + posX;
        const imgTop  = (wrapper.clientHeight - imgHeight * scale) / 2 + posY;
    
        const x = imgLeft + percentX * imgWidth * scale;
        const y = imgTop  + percentY * imgHeight * scale;
    
        return { x, y };
    }
    function showHeart(seat) {
        if(!tablePositions[seat]) return;
        heart.dataset.seat = seat;
        const { x, y } = getHeartPosition(seat);
        heart.style.left = x + "px";
        heart.style.top  = y + "px";
        heart.style.display = "block";
    }
    
    function hideHeart() {
        heart.style.display = "none";
        delete heart.dataset.seat;
    }
    
    function updateHeart() {
        if (!heart.dataset.seat) return;
        const { x, y } = getHeartPosition(heart.dataset.seat);
        heart.style.left = x + "px";
        heart.style.top  = y + "px";
    }
    
</script>


</body>
</html>
